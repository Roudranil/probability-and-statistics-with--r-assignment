---
title: "**Probability and Statistics with R**"
author: "**Assignment 2**"
date: "Submission Nov 16-2022 (Wednesday)"
output: html_dcument
---

```{r}
library(tidyverse)
library(scales)
```

# Q3

```{r}
data_q3 <- faithful %>% 
    as_tibble()

x <- sort(data_q3$waiting)

hist(x[x<65], xlab = 'waiting', probability = T, col='pink', main='')

```

comparing 3 models

```{r}
# model 1

p <- length(x[x<65])/length(x)

as <- mean(x[x<65])
ass <- var(x[x<65])
s <- ass/as
a <- as/s

mu <- mean(x[x>=65])
sigma <- sd(x[x>=65])

theta_inital <- c(p, a, s, mu, sigma)

neg_log_likelihood <- function(theta, data){
    n = length(data)
    
    p = theta[1]
    a = theta[2]
    s = theta[3]
    mu = theta[4]
    sigma = theta[5]
    
    l = 0
    for (i in 1:n) {
        l = l + log(p*dgamma(data[i], shape = a, scale = s) + (1-p)*dnorm(data[i], mean = mu, sd = sigma))
    }
    return(-l)
}

fit = optim(theta_inital,
      neg_log_likelihood,
      data = x,
      control = list(maxit = 1500),
      lower = c(0, 0, 0, -Inf, 0),
      upper = c(1, Inf, Inf, Inf, Inf),
      method="L-BFGS-B")

theta = fit$par

p = theta[1]
a = theta[2]
s = theta[3]
mu = theta[4]
sigma = theta[5]

model_1 = p*dgamma(x, shape = a, scale = s) + (1-p)*dnorm(x, mean = mu, sd = sigma)

# hist(x, xlab = 'waiting', probability = T, col='pink', main='')
# lines(x, model_1)
```

```{r}
# model 2

p <- length(x[x<65])/length(x)

as_1 <- mean(x[x<65])
ass_1 <- var(x[x<65])
s_1 <- ass_1/as_1
a_1 <- as_1/s_1

as_2 <- mean(x[x>=65])
ass_2 <- var(x[x>=65])
s_2 <- ass_2/as_2
a_2 <- as_2/s_2

theta_inital <- c(p, a_1, s_1, a_2, s_2)

neg_log_likelihood <- function(theta, data){
    n <- length(data)
    
    p <- theta[1]
    a_1 <- theta[2]
    s_1 <- theta[3]
    a_2 <- theta[4]
    s_2 <- theta[5]
    
    l = 0
    for (i in 1:n) {
        l = l + log(p*dgamma(data[i], shape = a_1, scale = s_1) + (1-p)*dgamma(data[i], shape = a_2, scale = s_2))
    }
    return(-l)
}

fit = optim(theta_inital,
      neg_log_likelihood,
      data = x,
      control = list(maxit = 1500),
      lower = c(0, 0, 0, 0, 0),
      upper = c(1, Inf, Inf, Inf, Inf),
      method="L-BFGS-B")

theta <- fit$par

p <- theta[1]
a_1 <- theta[2]
s_1 <- theta[3]
a_2 <- theta[4]
s_2 <- theta[5]

model_2 <- p*dgamma(x, shape = a_1, scale = s_1) + (1-p)*dgamma(x, shape = a_2, scale = s_2)

hist(x, xlab = 'waiting', probability = T, col='pink', main='')
lines(x, model_2)
```

```{r}
# model 3

p <- length(x[x<65])/length(x)

m_1 <- mean(x[x<65])
v_1 <- var(x[x<65])
sigma2_1 <- 
```




